---

title: Synthetic task


keywords: fastai
sidebar: home_sidebar



nb_path: "nbs/10_experiment.synthetic-task.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/10_experiment.synthetic-task.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">fastai.text.all</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">Dataset</span>
<span class="kn">from</span> <span class="nn">reformer_fastai.transformer</span> <span class="kn">import</span> <span class="n">TransformerLM</span>
<span class="kn">from</span> <span class="nn">reformer_fastai.reformer</span> <span class="kn">import</span> <span class="n">LSHLM</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="/reformer_fastai/images/paper_table2.png" alt="paper_table2.png"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Create-dataset">Create dataset<a class="anchor-link" href="#Create-dataset"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We want to create sequences of the form 0w0w, where w is a sequence of integeres between 1-127 of some lenght: eg. 08470847.
We create items on the fly instead of all items up front. We return a tuple to make the dataloader a bit easier to inspect.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">TwinSequence</span><span class="p">(</span><span class="n">Dataset</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sl</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span> <span class="nb">len</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">sl</span><span class="o">%</span><span class="k">2</span> == 0
        <span class="bp">self</span><span class="o">.</span><span class="n">sl</span> <span class="o">=</span> <span class="n">sl</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">len</span> <span class="o">=</span> <span class="nb">len</span>
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="n">seq</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">128</span><span class="p">,(</span><span class="bp">self</span><span class="o">.</span><span class="n">sl</span><span class="o">//</span><span class="mi">2</span><span class="p">,))</span>             <span class="c1"># w: [1-127] of len sl//2</span>
        <span class="n">seq</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>                                           <span class="c1"># seq = 0w</span>
        <span class="n">seq</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">seq</span><span class="p">,</span><span class="n">seq</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>                       <span class="c1"># seq = 0w0w</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">seq</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">0</span><span class="p">])),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># return offset target x:[0123], y:[1230]</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>                     
    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">len</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dls</span> <span class="o">=</span> <span class="n">DataLoaders</span><span class="o">.</span><span class="n">from_dsets</span><span class="p">(</span><span class="n">TwinSequence</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="n">bs</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cuda&#39;</span><span class="p">)</span>
<span class="n">xb</span><span class="p">,</span> <span class="n">yb</span> <span class="o">=</span> <span class="n">dls</span><span class="o">.</span><span class="n">one_batch</span><span class="p">()</span>
<span class="n">xb</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">yb</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(torch.Size([6, 10]), torch.Size([6, 10]))</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Note that the final target item is a padded 0. But that should also be predicitable from the first part of the input sequence:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">xb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">yb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>([0, 56, 58, 55, 119, 0, 56, 58, 55, 119],
 [56, 58, 55, 119, 0, 56, 58, 55, 119, 0])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The number of batches in train data loader (<code>n_iter</code> in fastai lingo): The reformer paper mentions 150 k steps. One step is one iteration/batches.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">dls</span><span class="o">.</span><span class="n">train</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>8</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Target-masking">Target masking<a class="anchor-link" href="#Target-masking"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We have to mask the <strong>first half</strong> of the targets. The first part is just random integers, so it's impossible to learn anything from it. We set the tokens in the first part to a special index, -100, and later tell our lossfunction to ignore items with this value. This means that the only task the model can learn is to copy the first part of the input sequence. If we didn't mask the first part, it would be penalized for poor performance in the first part, and would try to find a compromise.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">MaskTargCallback</span><span class="p">(</span><span class="n">Callback</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">before_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[:,</span> <span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">dls</span><span class="o">.</span><span class="n">train_ds</span><span class="o">.</span><span class="n">sl</span><span class="o">//</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We create a custom accuracy that also disregards tokens with value -100:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">masked_accuracy</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="n">targ</span><span class="p">,</span> <span class="n">ignore</span><span class="o">=-</span><span class="mi">100</span><span class="p">):</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">inp</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">targ</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">ignore</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">pred</span><span class="p">[:,</span><span class="n">mask</span><span class="p">]</span> <span class="o">==</span> <span class="n">targ</span><span class="p">[:,</span><span class="n">mask</span><span class="p">])</span><span class="o">.</span><span class="n">float</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pred</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">1</span><span class="p">,</span>   <span class="mi">2</span><span class="p">,</span>   <span class="mi">3</span><span class="p">,</span>   <span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">55</span><span class="p">])[</span><span class="kc">None</span><span class="p">,:]</span>
<span class="n">targ</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">0</span><span class="p">])[</span><span class="kc">None</span><span class="p">,:]</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">targ</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">100</span>
<span class="p">(</span><span class="n">pred</span><span class="p">[:,</span><span class="n">mask</span><span class="p">]</span> <span class="o">==</span> <span class="n">targ</span><span class="p">[:,</span><span class="n">mask</span><span class="p">])</span><span class="o">.</span><span class="n">float</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>tensor(0.8000)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>And finally a callback to inspect items directly before modelling:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">Inspect_items</span><span class="p">(</span><span class="n">Callback</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">after_batch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iter</span><span class="o">==</span><span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">epoch</span><span class="o">==</span><span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">training</span><span class="p">:</span>
            <span class="n">inp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">targ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">((</span><span class="n">inp</span><span class="p">,</span><span class="n">targ</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
            <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;inp&#39;</span><span class="p">,</span> <span class="s1">&#39;targ&#39;</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Inspect-masking">Inspect masking<a class="anchor-link" href="#Inspect-masking"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's check what's actually going into the model with a tiny example:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bs</span><span class="p">,</span> <span class="n">sl</span> <span class="o">=</span> <span class="mi">64</span><span class="p">,</span><span class="mi">16</span>
<span class="n">n_epochs</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">train_sz</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">valid_sz</span> <span class="o">=</span> <span class="mi">100</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dls</span> <span class="o">=</span> <span class="n">DataLoaders</span><span class="o">.</span><span class="n">from_dsets</span><span class="p">(</span><span class="n">TwinSequence</span><span class="p">(</span><span class="n">sl</span><span class="p">,</span> <span class="n">train_sz</span><span class="p">),</span> <span class="n">TwinSequence</span><span class="p">(</span><span class="n">sl</span><span class="p">,</span> <span class="n">valid_sz</span><span class="p">),</span> <span class="n">bs</span><span class="o">=</span><span class="n">bs</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cuda&#39;</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">TransformerLM</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="n">d_ff</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">n_layers</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_heads</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">max_seq_len</span><span class="o">=</span><span class="n">sl</span><span class="p">,</span> <span class="n">pos_enc</span><span class="o">=</span><span class="s1">&#39;fixed&#39;</span><span class="p">,</span>
                      <span class="n">attn_dropout</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ff_dropout</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">emb_dropout</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">learn</span> <span class="o">=</span> <span class="n">Learner</span><span class="p">(</span><span class="n">dls</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">loss_func</span><span class="o">=</span><span class="n">CrossEntropyLossFlat</span><span class="p">(</span><span class="n">ignore_index</span><span class="o">=-</span><span class="mi">100</span><span class="p">),</span> 
                <span class="n">metrics</span><span class="o">=</span><span class="n">masked_accuracy</span><span class="p">,</span> <span class="n">cbs</span><span class="o">=</span><span class="p">[</span><span class="n">MaskTargCallback</span><span class="p">(),</span> <span class="n">Inspect_items</span><span class="p">()])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>masked_accuracy</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>4.671275</td>
      <td>4.565497</td>
      <td>0.125000</td>
      <td>00:02</td>
    </tr>
  </tbody>
</table>
</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>    inp  targ
0     0  -100
1    99  -100
2    69  -100
3    65  -100
4     8  -100
5    51  -100
6     6  -100
7    83  -100
8     0    99
9    99    69
10   69    65
11   65     8
12    8    51
13   51     6
14    6    83
15   83     0
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Looks good!</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Short-sequence-modelling">Short sequence modelling<a class="anchor-link" href="#Short-sequence-modelling"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>First we will test a short sequence to test that everything is working. We use the <a href="/reformer_fastai/transformer.html#TransformerLM"><code>TransformerLM</code></a> and compares it to the <a href="/reformer_fastai/reformer.html#LSHLM"><code>LSHLM</code></a>. Note that <a href="/reformer_fastai/reformer.html#LSHLM"><code>LSHLM</code></a> has the same <a href="/reformer_fastai/attention.html#LSHAttention"><code>LSHAttention</code></a> as the <a href="/reformer_fastai/reformer.html#ReformerLM"><code>ReformerLM</code></a>, but less the other reformer memory tricks.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bs</span><span class="p">,</span> <span class="n">sl</span> <span class="o">=</span> <span class="mi">64</span><span class="p">,</span><span class="mi">64</span>
<span class="n">n_epochs</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">train_sz</span> <span class="o">=</span> <span class="mi">50_000</span>
<span class="n">valid_sz</span> <span class="o">=</span> <span class="mi">10_000</span>
<span class="n">dls</span> <span class="o">=</span> <span class="n">DataLoaders</span><span class="o">.</span><span class="n">from_dsets</span><span class="p">(</span><span class="n">TwinSequence</span><span class="p">(</span><span class="n">sl</span><span class="p">,</span> <span class="n">train_sz</span><span class="p">),</span> <span class="n">TwinSequence</span><span class="p">(</span><span class="n">sl</span><span class="p">,</span> <span class="n">valid_sz</span><span class="p">),</span> <span class="n">bs</span><span class="o">=</span><span class="n">bs</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cuda&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Total training steps:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">dls</span><span class="o">.</span><span class="n">train</span><span class="p">)</span><span class="o">*</span><span class="n">n_epochs</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>781</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Transformer-LM---full-attention">Transformer LM - full attention<a class="anchor-link" href="#Transformer-LM---full-attention"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">TransformerLM</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="n">d_ff</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">n_layers</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_heads</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">max_seq_len</span><span class="o">=</span><span class="n">sl</span><span class="p">,</span> <span class="n">pos_enc</span><span class="o">=</span><span class="s1">&#39;fixed&#39;</span><span class="p">,</span>
                      <span class="n">attn_dropout</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ff_dropout</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">emb_dropout</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">learn</span> <span class="o">=</span> <span class="n">Learner</span><span class="p">(</span><span class="n">dls</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">loss_func</span><span class="o">=</span><span class="n">CrossEntropyLossFlat</span><span class="p">(</span><span class="n">ignore_index</span><span class="o">=-</span><span class="mi">100</span><span class="p">),</span> 
                <span class="n">metrics</span><span class="o">=</span><span class="n">masked_accuracy</span><span class="p">,</span> <span class="n">cbs</span><span class="o">=</span><span class="p">[</span><span class="n">MaskTargCallback</span><span class="p">()])</span>
<span class="n">learn</span><span class="o">.</span><span class="n">fit_one_cycle</span><span class="p">(</span><span class="n">n_epochs</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>masked_accuracy</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.002015</td>
      <td>0.001950</td>
      <td>0.999972</td>
      <td>00:17</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">recorder</span><span class="o">.</span><span class="n">plot_loss</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote><p>The model fairly quickly learns the copy task, and reaches near 0 loss within a few hundred steps</p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Test-inference-and-visualise-attention">Test inference and visualise attention<a class="anchor-link" href="#Test-inference-and-visualise-attention"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">dls</span><span class="o">.</span><span class="n">train_ds</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span>
<span class="n">x</span><span class="p">[:,</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">:],</span> <span class="n">x</span><span class="p">[:,</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(tensor([[  0,   1,  92, 105,  31,  84,  43, 112,  20,   7,  46,  90,  35,   5,
           70, 110,  76,  19,   8,  60,  73,  42, 103,  81,  20,  13,  32,  49,
           10,  39,  88, 122]], device=&#39;cuda:7&#39;),
 torch.Size([1, 32]))</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">store_attention</span><span class="p">()</span>
<span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">learn</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">preds</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)[:,</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">:]</span>
<span class="p">(</span><span class="n">preds</span><span class="p">[:,:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="n">x</span><span class="p">[:,</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">:])</span><span class="o">.</span><span class="n">float</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>tensor(1., device=&#39;cuda:7&#39;)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">attn</span> <span class="o">=</span> <span class="n">learn</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">get_attention_matrix</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We have 4 heads in our transformer, and 1 attention matrix per head:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote><p><strong>The attention matrices shows us that mid way through the sequence the model starts paying attention to the first input sequence as expected. Each layers learns a bit different, but the combined output is good enough for perfect sequence copying. Note that there is no pattern to learn before this point, so the attention is just random noise. We also see that no token peeks ahead of it's own location, which we would expect from a language model with causal attention.</strong></p>
</blockquote>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span>
<span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">mat</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="n">attn</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">del</span> <span class="n">learn</span>
<span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">empty_cache</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="LSHLM">LSHLM<a class="anchor-link" href="#LSHLM"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Note!</strong> Sequence length <a href="/reformer_fastai/experiment.synthetic-script.html#sl"><code>sl</code></a> needs to be divisible by <a href="/reformer_fastai/experiment.synthetic-script.html#bucket_size"><code>bucket_size</code></a>x2. So e.g. <code>sl=64</code> -&gt; <code>bucket_size=32</code></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">n_hashes</span><span class="o">=</span><span class="mi">4</span>
<span class="n">bucket_size</span> <span class="o">=</span> <span class="mi">32</span>
<span class="k">assert</span> <span class="n">sl</span> <span class="o">%</span> <span class="p">(</span><span class="n">bucket_size</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">LSHLM</span><span class="p">(</span><span class="n">vocab_sz</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">d_model</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">n_layers</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_heads</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">max_seq_len</span><span class="o">=</span><span class="n">sl</span><span class="p">,</span>
              <span class="n">bucket_size</span><span class="o">=</span><span class="n">bucket_size</span><span class="p">,</span> <span class="n">n_hashes</span><span class="o">=</span><span class="n">n_hashes</span><span class="p">,</span> <span class="n">causal</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span> <span class="o">=</span> <span class="n">Learner</span><span class="p">(</span><span class="n">dls</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">loss_func</span><span class="o">=</span><span class="n">CrossEntropyLossFlat</span><span class="p">(</span><span class="n">ignore_index</span><span class="o">=-</span><span class="mi">100</span><span class="p">),</span> 
                <span class="n">metrics</span><span class="o">=</span><span class="n">masked_accuracy</span><span class="p">,</span> <span class="n">cbs</span><span class="o">=</span><span class="p">[</span><span class="n">MaskTargCallback</span><span class="p">()])</span>
<span class="n">learn</span><span class="o">.</span><span class="n">fit_one_cycle</span><span class="p">(</span><span class="n">n_epochs</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>masked_accuracy</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.001956</td>
      <td>0.000564</td>
      <td>1.000000</td>
      <td>01:26</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">recorder</span><span class="o">.</span><span class="n">plot_loss</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAWwAAAD4CAYAAADIH9xYAAAAOXRFWHRTb2Z0d2FyZQBNYXRwbG90bGliIHZlcnNpb24zLjMuMiwgaHR0cHM6Ly9tYXRwbG90bGliLm9yZy8vihELAAAACXBIWXMAAAsTAAALEwEAmpwYAAAfMklEQVR4nO3deXRc5Z3m8e+vSqWtVLJWy7IsW/JubIRshGMCIQQIbXYyoRPnQDqdZIZ0ltNA9zkJSWY6oc/MnEymT3eGnpAECFk6LGFMaAhNAoGYEIJZbGIbeQdvkhdJli1LsnbpnT+qvMuSLFfpVt16PufUqatbt6oe2fLjq/e+da855xARkeQX8DqAiIiMjQpbRCRFqLBFRFKECltEJEWosEVEUkRGIl60pKTEVVVVJeKlRUR8ae3atQedc6UjbZOQwq6qqmLNmjWJeGkREV8ys92jbaMhERGRFDGmPWwz2wV0AIPAgHOuLpGhRETkTOcyJPIR59zBhCUREZERJWQMW0TkXPT399PY2EhPT4/XURIuOzubadOmEQqFzvm5Yy1sB7xoZg74kXPuwdM3MLM7gTsBpk+ffs5BRCR9NTY2EolEqKqqwsy8jpMwzjlaW1tpbGykurr6nJ8/1oOOlznnlgDXAV82syuGCfKgc67OOVdXWjrizBQRkVP09PRQXFzs67IGMDOKi4vH/ZvEmArbObcvdt8MPA0sHde7iYichd/L+pjz+T5HLWwzC5tZ5NgycC1QP+53HMH9L2/n8bf2sK6hjaO9A4l4CxGRlDWWMewy4OnY/woZwGPOud/GO0j/4BAP/3EH7T0nirowN0RlUS4VBTlMLcihqiTM3Ml5zC2LUBjOjHcEEUlTbW1tPPbYY3zpS186p+ddf/31PPbYYxQUFCQm2GlGLWzn3A7gokQHCQUDrPuHa2k83M2m/e3sONhJ4+FuGg51sbWpg1Vbm+npHzq+fUleFnPLouU9J3Y/d3KESbnnfuRVRNJbW1sbDzzwwBmFPTg4SDAYPOvznn/++URHO0VSTesLBIzpxblML8494zHnHPuO9LCtqYPtTR1sa+pke1MHT65poKtv8Ph2kyNZzJsSYV5ZhHlTIsyfks+csjyyQ2f/QxeR9Hbvvffy/vvvU1tbSygUIi8vj/LyctatW8emTZu49dZbaWhooKenh7vuuos777wTOHEajs7OTq677jouv/xyXn/9dSoqKnjmmWfIycmJa86kKuyRmBkVBTlUFOTwkXmTj68fGnLsbetme3MH25s62drUwdYDHfz8jd30DUT3yAMGVcVh5pZFmDU5zKzSPGaW5jGzNEx+tvbIRZLJfb/eyKZ97XF9zQum5vOtmxae9fHvfOc71NfXs27dOl555RVuuOEG6uvrj0+9e+SRRygqKqK7u5tLLrmEj3/84xQXF5/yGtu3b+fxxx/noYce4hOf+ARPPfUUd9xxR1y/j5Qp7LMJBIzKolwqi3K5an7Z8fUDg0PsPtTF1gMdbDnQwbYDHWxr6uB3m5sYHDpxHcvSSBazSsPMLM1jRlEu02OvNb04V2UukqaWLl16yjzp+++/n6effhqAhoYGtm/ffkZhV1dXU1tbC8DFF1/Mrl274p4r5Qv7bDKCAWaV5jGrNI/rLyw/vr5vYIg9h7rY0dLJ+y1HY/ed/Obd/Rzu6j/lNQpzQ0wvymVqQQ6lkSxK87Ioid2XRqLLBTkhcjODaTMlSSTRRtoTnijhcPj48iuvvMJLL73E6tWryc3N5corrxx2HnVWVtbx5WAwSHd3d9xz+bawzyYzI8DsyXnMnpx3xmPtPf3sae2i4VAXe066bW/u5PX3WznS3T/MK0aHXMJZGeRnh8jLyiCSnUFedkZsORT9+tj64/chwllB8rKi24azMghnZhAMqPhFJlokEqGjo2PYx44cOUJhYSG5ubls2bKFN954Y4LTnZB2hT2S/OwQiyomsahi0rCP9w4M0trZR0tHb/TW2Ut7dz+dvQN09ERvnb3Rrw8d7WNPaxcdvQN09PSfMsNlJDmhIHnZGUzJz6ayKIfpRWGWVheybGYxuZn66xJJhOLiYi677DIWLVpETk4OZWUnhleXL1/OD3/4Q2pqapg3bx7Lli3zLKc550bf6hzV1dU5XcDgVP2DQxw9qdiP9g3Q2TNAZ2/0djR23xl7fH97D42Ho3v7/YOOSHYGf/3BKr5y1WyyMjTjRfxl8+bNLFiwwOsYE2a479fM1o526mrtsk2QUDBAQW4mBbnn9oGfnv5B1uw6zONv7eFff/8eq99v5WefW0o4S391IulGV5xJctmhIJfPKeH7ty/hXz+1mD83tPHVlRtIxG9GIpLcVNgp5KaLpvJ3H53Lf7y7nxc2NnkdR0QmmAo7xXzhipnMKg3zTy9uPWU+uYj4nwo7xWQEA/zt1XN4r7mTV7e1eB1HRCaQCjsFXbeonJK8TB59c4/XUURkAqmwU1BmRoCPLa7gD9uaae8Z/sM8IpJYeXnRD9/t27eP2267bdhtrrzySuI5xVmFnaKWLyqnf9Cxakuz11FE0trUqVNZuXLlhLyXCjtFLa4soDSSxYubNFtEJB6+9rWv8cADDxz/+tvf/jb33XcfV199NUuWLOHCCy/kmWeeOeN5u3btYtGiRQB0d3ezYsUKampq+OQnPxn384no0xcpKhAwPjS7hD9sa2FoyBHQOUjEL35zLxx4N76vOeVCuO47I26yYsUK7r777uMXMXjyySf57W9/yz333EN+fj4HDx5k2bJl3HzzzWc92dsPfvADcnNz2bBhAxs2bGDJkiVx/Ta0h53CPji7hNajfWxtGv6kNSIydosXL6a5uZl9+/axfv16CgsLKS8v5xvf+AY1NTVcc8017N27l6ams/9W++qrrx4/B3ZNTQ01NTVxzag97BR26azo+Xjf2NHKgvJ8j9OIxMkoe8KJdNttt7Fy5UoOHDjAihUrePTRR2lpaWHt2rWEQiGqqqqGPbXqyRJ5qmXtYaewioIcpuRns66hzesoIr6wYsUKnnjiCVauXMltt93GkSNHmDx5MqFQiFWrVrF79+4Rn3/FFVfw6KOPAlBfX8+GDRvimk972CnuospJrFdhi8TFwoUL6ejooKKigvLycm6//XZuuukm6urqqK2tZf78+SM+/4tf/CKf/exnqampoba2lqVLl8Y1nwo7xV1UWcALG5to6+o75zMBisiZ3n33xAHPkpISVq9ePex2nZ2dQPRCvPX19QDk5OTwxBNPJCybhkRSXG1lAYCGRUTSgAo7xV1YMQkzFbZIOlBhp7hIdojqkjCb9rV7HUXkvKTLOd7P5/tUYfvA/CkRzcWWlJadnU1ra6vvS9s5R2trK9nZ2eN6vg46+sC8snx+U3+Arr4BXahXUtK0adNobGykpcX/pwzOzs5m2rRp43qu/nX7wLwpEZyDbU2dxw9CiqSSUChEdXW11zGSnoZEfGD+lAgAWw9oHFvEz1TYPjC9KJecUJAtBzSOLeJnKmwfCASMuWV5bFVhi/jamAvbzIJm9mczey6RgWR8Zk+O8H5Lp9cxRCSBzmUP+y5gc6KCyPmZWRqmqb2XDl0yTMS3xlTYZjYNuAF4OLFxZLxmlUavL7fz4FGPk4hIoox1D/t7wFeBocRFkfMxqzQMwI4WFbaIX41a2GZ2I9DsnFs7ynZ3mtkaM1uTDpPfk8304lwChsaxRXxsLHvYlwE3m9ku4AngKjP7xekbOecedM7VOefqSktL4xxTRpOVEaSyKFd72CI+NmphO+e+7pyb5pyrAlYAv3fO3ZHwZHLOZpXmaQ9bxMc0D9tHZpaE2XnwKEND/j6Bjki6OqfCds694py7MVFh5PzMLM2jd2CIvW3dXkcRkQTQHraPHJspomEREX9SYfvITM3FFvE1FbaPlORlEsnKUGGL+JQK20fMjOrSsApbxKdU2D5TXRLWXGwRn1Jh+0x1SZh9R7rp6R/0OoqIxJkK22eqS8I4B7tbu7yOIiJxpsL2mRNn7dPUPhG/UWH7TFVJ7Kx9OvAo4jsqbJ/Jy8pgciSLnTrwKOI7Kmwfqi4Jaw9bxIdU2D40U3OxRXxJhe1D1SVhDh3to62rz+soIhJHKmwfqi7ROUVE/EiF7UMzY2ftU2GL+IsK24cqC3MJBkyFLeIzKmwfyswIUFmYo5kiIj6jwvap6pKw5mKL+IwK26eqS/LYefAozun6jiJ+ocL2qerSMN39gxxo7/E6iojEiQrbp2bGzimiYRER/1Bh+9SxqX068CjiHypsnyqLZJMTCmpqn4iPqLB9KhAwqkp0ThERP1Fh+9hMFbaIr6iwfay6JMyeQ130Dw55HUVE4kCF7WPVJWEGhxwNh3R9RxE/UGH7WLVOAiXiKypsHzs2F3uH5mKL+IIK28cKcjMpCmdqLraIT6iwfa66JMzOg51exxCROFBh+1y1pvaJ+MaohW1m2Wb2lpmtN7ONZnbfRAST+KguCdPU3ktn74DXUUTkPI1lD7sXuMo5dxFQCyw3s2UJTSVxM2dy9PqO25s6PE4iIudr1MJ2UccGQUOxm06ynCLmlkUA2N6kcWyRVDemMWwzC5rZOqAZ+J1z7s1htrnTzNaY2ZqWlpY4x5TxqizKJTsUYKv2sEVS3pgK2zk36JyrBaYBS81s0TDbPOicq3PO1ZWWlsY5poxXMGDMnpzHNhW2SMo7p1kizrk24BVgeSLCSGLMLYtoSETEB8YyS6TUzApiyznANcCWBOeSOJpbFuFAew9Huvu9jiIi52Ese9jlwCoz2wC8TXQM+7nExpJ4mlummSIifpAx2gbOuQ3A4gnIIglybKbI1qYO6qqKPE4jIuOlTzqmgYqCHMKZQY1ji6Q4FXYaMDNml0U0U0Qkxamw08S8Mk3tE0l1Kuw0MbcswsHOPlo7e72OIiLjpMJOE3NiBx63aRxbJGWpsNPEvGMzRQ60e5xERMZLhZ0myvKzKApnsnm/xrFFUpUKO02YGQun5rNx/xGvo4jIOKmw08gF5flsO9BJ/+CQ11FEZBxU2Gnkgqn59A0O8V6zDjyKpCIVdhpZODUfgI37dOBRJBWpsNNIdUkeOaEgm1TYIilJhZ1GggFjfnmEjft04FEkFamw08wF5fls2t+Oc7osp0iqUWGnmYVTJ9HRM0Dj4W6vo4jIOVJhp5kTBx41LCKSalTYaWbelAjBgOnAo0gKUmGnmexQkFmlYepV2CIpR4Wdhi6sKGBDY5sOPIqkGBV2GqqtnMTBzj72tunAo0gqUWGnodrKQgDWNbR5G0REzokKOw3NL4+QmRFg3Z42r6OIyDlQYaehUDDAoqn52sMWSTEq7DRVW1nIu3uP6FSrIilEhZ2maqcX0DswxNYDugKNSKpQYaepxZUFgA48iqQSFXaamlaYQ1E4U4UtkkJU2GnKzKitLFBhi6QQFXYaq60s4P2WTtp7+r2OIiJjoMJOYxfPKMQ5WLv7sNdRRGQMVNhpbPH0AjICxts7D3kdRUTGYNTCNrNKM1tlZpvNbKOZ3TURwSTxcjMzWFgxibd3qbBFUsFY9rAHgL93zi0AlgFfNrMLEhtLJsrSqkLWNxyhp3/Q6ygiMopRC9s5t985905suQPYDFQkOphMjEuqiugbHGJDo65AI5LszmkM28yqgMXAm8M8dqeZrTGzNS0tLXGKJ4l2SVURgIZFRFLAmAvbzPKAp4C7nXNnXK7EOfegc67OOVdXWloaz4ySQIXhTOZMzuNNHXgUSXpjKmwzCxEt60edc79KbCSZaJdUF/HO7sMM6ERQIkltLLNEDPgxsNk598+JjyQTbdnMYjp7B3SdR5EkN5Y97MuATwNXmdm62O36BOeSCfTBWcUA/Om9gx4nEZGRZIy2gXPuNcAmIIt4pCQviwXl+fxxewtf/shsr+OIyFnok44CwIfmlPDO7ja6+ga8jiIiZ6HCFgAum11C3+AQb+/SeUVEkpUKWwC4pKqQzGCA17ZrDr1IslJhCxA9r8iSGQW89l6r11FE5CxU2HLch+aUsnl/Owc7e72OIiLDUGHLcZfNLgE0vU8kWamw5bgLKyZRFM5k1ZZmr6OIyDBU2HJcMGBcOa+UVVtb9DF1kSSkwpZTXLOgjCPd/bpsmEgSUmHLKT40p4RQ0HhZwyIiSUeFLaeIZIdYNrOYlzY3eR1FRE6jwpYzXLOgjB0tR9l58KjXUUTkJCpsOcPVCyYD8LL2skWSigpbzjCtMJf5UyK8uEmFLZJMVNgyrOWLpvD2rkM0t/d4HUVEYlTYMqwba8pxDp5/d7/XUUQkRoUtw5o9OcL8KRGe26DCFkkWKmw5qxtrylmz+zD72rq9jiIiqLBlBDfWTAU0LCKSLFTYclZVJWEWVeTzaw2LiCQFFbaM6MaaqaxvaGN3qz5EI+I1FbaM6JbaqQQMVq5t9DqKSNpTYcuIyiflcMXcUlaubWRwyHkdRyStqbBlVJ+oq2T/kR5e05VoRDylwpZRXbOgjKJwJk+uafA6ikhaU2HLqDIzAtxaW8HvNjZx+Gif13FE0pYKW8bkE5dMo29wiF/9ea/XUUTSlgpbxmT+lHyWTC/g31bvYkgHH0U8ocKWMfvsZdXsau1i1VZdPkzECypsGbPli6YwJT+bn76+y+soImlJhS1jFgoG+PSlM/jj9oNsb+rwOo5I2hm1sM3sETNrNrP6iQgkye1TS6eTlRHgJ9rLFplwY9nD/imwPME5JEUUhTP52OIKnlrbSHOHrkYjMpFGLWzn3KvAoQnIIinibz48i/7BIR56dYfXUUTSisaw5ZxVlYS5pbaCX7yxh9bOXq/jiKSNuBW2md1pZmvMbE1LS0u8XlaS1Jc/MpuegUEefm2n11FE0kbcCts596Bzrs45V1daWhqvl5UkNXtyHjdcWM7PX9+lj6uLTBANici4/e3Vc+juH+T/rnrP6ygiaWEs0/oeB1YD88ys0cw+n/hYkgrmlkX4y4sr+fnqXTQc6vI6jojvjWWWyKecc+XOuZBzbppz7scTEUxSwz0fnUswYHz3ha1eRxHxPQ2JyHmZMimb//Khmfx6/T7WNbR5HUfE11TYct6+8OFZlORl8a1nN+oyYiIJpMKW85aXlcF/u3EB6xvaeOzN3V7HEfEtFbbExc0XTeXy2SV897dbaW7XR9ZFEkGFLXFhZvz3WxfROzjEfb/e5HUcEV9SYUvcVJWEuevqOfzHu/t5Zp0uJSYSbypsiasvXDGTJdML+K//Xs/etm6v44j4igpb4iojGOBfPlnL0JDj759cp+s/isSRClvibkZxmG/dtJA3dhzi/t9v9zqOiG+osCUh/rJuGv9pSQXfe2k7L29u8jqOiC+osCUhzIz/+bELuaA8n7t/uY5dB496HUkk5amwJWGyQ0F+9OmLCQaMz/30bQ7pNKwi50WFLQlVWZTLQ39VR2NbN5//2dt09w16HUkkZamwJeEuqSri/hW1rGto4yuPvUPfwJDXkURSkgpbJsTyReX84y2LeHlLs0pbZJxU2DJhPr1sBvfdvJAXNzXxpUffoXdAwyMi50KFLRPqMx+s4h9vWchLm5v4zCNvcaSr3+tIIilDhS0T7q8ureJ7n6xl7e7DfPyHr9N4WJcXExkLFbZ44tbFFfz8cx+gub2HW7//Oqvfb/U6kkjSU2GLZy6dVcyvvvRB8nMyuP3hN/j+qvd07hGREaiwxVOzJ0d49iuXc0PNVP73C1v5zE/e0ln+RM5ChS2ey8vK4P4VtfyPjy1i7e7D/MW/vMqjb+7GOe1ti5xMhS1Jwcy4/QMzeOHuK7iochLffLqe2364mvW6ErvIcSpsSSqVRbn84vMf4Lsfr2F3axe3fP9P3PPLdRomEQEsEb921tXVuTVr1sT9dSW9dPT088Ar7/Pj13binOO2i6fxxQ/PZnpxrtfRROLOzNY65+pG3EaFLcmu8XAXP/rDDn65poHBIccNF5bz6UtnUDejEDPzOp5IXKiwxVea2nt46NUd/PLtBjp6B5hXFuH2ZdO5qWYqheFMr+OJnBcVtvhSV98Az67bxy/e3E393nYyAsblc0q4sWYq1y4sIz875HVEkXOmwhbfq997hF+v38dzG/azt62bjICxZEYhV84r5cNzS7mgPF/DJpISVNiSNpxzvLOnjZc2N/GHrS1s2t8OQFE4kyXTC6mrKqRuRiGLKiaRHQp6nFbkTCpsSVvN7T38YVsLb+48xNrdh9kZu6ZkRsCYPTmP+VMiLCjPZ355PvOnRJgcydKeuHhKhS0S09rZy9rdh1nX0MaWAx1s3t/O/iM9xx/PzQwyvSiXquIwM4pzmVEcpqIwhyn52ZTlZzEpJ6RCl4QaS2FnjPGFlgP/BwgCDzvnvhOHfCITpjgvi2sXTuHahVOOr2vr6mPLgQ62HuhgV+tR9rR2sb25g99vaaZv8NQr4mRlBCiLlffkSDYFuSEKckMU5mYyKSd6H12XSX5OBuHMDHJCQQIBlbzEz6iFbWZB4PvAR4FG4G0ze9Y5tynR4UQSqSA3k2Uzi1k2s/iU9YNDjgPtPexv6+ZAew9N7b00t/fElnvYcqCdtq5+2rr7GRzl7IK5mUHCWRmEM4PkZmYQzore52YGycoIkBm7ZWUEo8vBY1+fep8ZDBIMGBkBI3iWW0bACJiRETSCNvw2ATOM6KkAAgaGgRFdjj0WMOPYLxNmnPkc/abhmbHsYS8F3nPO7QAwsyeAWwAVtvhSMGBUFORQUZAz4nbOOTp6BzjS1c/hrj7aYvftPQN09Q5wtG/wxH3fAEd7BznaO0BbVx972wbpGxiidyB63zcwRN/gEP2DqXPCq1PL/EThn17yZzxvlBXD/Xdw+uuc/rJjes4w+Yd51jje58TyZy+r5m8+PGu4F46LsRR2BdBw0teNwAdO38jM7gTuBJg+fXpcwokkMzMjPztEfnaIyqL4fFx+aMjRNxgt797+6P2xQh8YGmJoiOi9cwwMOgadY3DIMTDkGDr9fphtnHM4F/3PZsiBg+NnRRw69thJy3DStg4c0WWciz03tm1s2R1fjm13mtMPmUW3Pvvjwzn9uNtwTxnP+5y+6sxtznzS6dtUFYeHSRM/Yyns4f5TOfNbce5B4EGIHnQ8z1wiaSkQMLIDwejUw2yv00iyGcvZ+hqBypO+ngbsS0wcERE5m7EU9tvAHDOrNrNMYAXwbGJjiYjI6UYdEnHODZjZV4AXiE7re8Q5tzHhyURE5BRjmoftnHseeD7BWUREZAS64oyISIpQYYuIpAgVtohIilBhi4ikiIScrc/MWoDd5/i0EuBg3MPEh7KNTzJng+TOp2zjk8zZYOR8M5xzpSM9OSGFPR5mtma0Uwt6RdnGJ5mzQXLnU7bxSeZscP75NCQiIpIiVNgiIikimQr7Qa8DjEDZxieZs0Fy51O28UnmbHCe+ZJmDFtEREaWTHvYIiIyAhW2iEiK8LywzWy5mW01s/fM7F6PMjxiZs1mVn/SuiIz+52ZbY/dF5702Ndjebea2V8kMFelma0ys81mttHM7kqWbLH3yjazt8xsfSzffcmUL/Z+QTP7s5k9l0zZzGyXmb1rZuvMbE2SZSsws5VmtiX2s3dpEmWbF/szO3ZrN7O7kyjfPbF/C/Vm9njs30j8skUvGeTNjejpWt8HZgKZwHrgAg9yXAEsAepPWvdd4N7Y8r3A/4otXxDLmQVUx/IHE5SrHFgSW44A22Lv73m22PsZkBdbDgFvAsuSJV/sPf8OeAx4Lln+XmPvtwsoOW1dsmT7GfCfY8uZQEGyZDstZxA4AMxIhnxEL6e4E8iJff0k8NfxzJbwP9RRvsFLgRdO+vrrwNc9ylLFqYW9FSiPLZcDW4fLSPQ84ZdOUMZniF69Phmz5QLvEL3eZ1LkI3p1pJeBqzhR2MmSbRdnFrbn2YD8WOlYsmUbJuu1wJ+SJR8nrn9bRPTU1c/FMsYtm9dDIsNd4LfCoyynK3PO7QeI3U+Orfcks5lVAYuJ7sUmTbbYkMM6oBn4nXMumfJ9D/gqMHTSumTJ5oAXzWytRS9gnSzZZgItwE9iQ0kPm1k4SbKdbgXweGzZ83zOub3APwF7gP3AEefci/HM5nVhj+kCv0lmwjObWR7wFHC3c659pE2HWZfQbM65QedcLdG92aVmtmiEzScsn5ndCDQ759aO9SnDrEvkn91lzrklwHXAl83sihG2nchsGUSHB3/gnFsMHCX6a/zZePJv2KKXK7wZ+H+jbTrMukT9zBUCtxAd3pgKhM3sjnhm87qwk/kCv01mVg4Qu2+OrZ/QzGYWIlrWjzrnfpVM2U7mnGsDXgGWJ0m+y4CbzWwX8ARwlZn9Ikmy4ZzbF7tvBp4GliZJtkagMfabEsBKogWeDNlOdh3wjnOuKfZ1MuS7BtjpnGtxzvUDvwI+GM9sXhd2Ml/g91ngM7HlzxAdPz62foWZZZlZNTAHeCsRAczMgB8Dm51z/5xM2WL5Ss2sILacQ/QHdksy5HPOfd05N805V0X05+r3zrk7kiGbmYXNLHJsmeg4Z30yZHPOHQAazGxebNXVwKZkyHaaT3FiOORYDq/z7QGWmVlu7N/u1cDmuGabiIMDowzUX0909sP7wDc9yvA40TGnfqL/630eKCZ6wGp77L7opO2/Gcu7FbgugbkuJ/or0gZgXex2fTJki71XDfDnWL564B9i65Mi30nveSUnDjp6no3oOPH62G3jsZ/7ZMgWe69aYE3s7/XfgcJkyRZ7v1ygFZh00rqkyAfcR3SnpR74N6IzQOKWTR9NFxFJEV4PiYiIyBipsEVEUoQKW0QkRaiwRURShApbRCRFqLBFRFKECltEJEX8fzagGWsJKGGFAAAAAElFTkSuQmCC
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">del</span> <span class="n">learn</span>
<span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">empty_cache</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Test-attention-type-switching">Test attention type switching<a class="anchor-link" href="#Test-attention-type-switching"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's see if we can train a model with full attention and evaluate with LSH-1.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">LSHLM</span><span class="p">(</span><span class="n">vocab_sz</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">d_model</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">n_layers</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_heads</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">max_seq_len</span><span class="o">=</span><span class="n">sl</span><span class="p">,</span>
              <span class="n">bucket_size</span><span class="o">=</span><span class="n">bucket_size</span><span class="p">,</span> <span class="n">n_hashes</span><span class="o">=</span><span class="n">n_hashes</span><span class="p">,</span> <span class="n">causal</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
              <span class="n">use_lsh</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># disable LSH</span>
<span class="n">learn</span> <span class="o">=</span> <span class="n">Learner</span><span class="p">(</span><span class="n">dls</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">loss_func</span><span class="o">=</span><span class="n">CrossEntropyLossFlat</span><span class="p">(</span><span class="n">ignore_index</span><span class="o">=-</span><span class="mi">100</span><span class="p">),</span> 
                <span class="n">metrics</span><span class="o">=</span><span class="n">masked_accuracy</span><span class="p">,</span> <span class="n">cbs</span><span class="o">=</span><span class="p">[</span><span class="n">MaskTargCallback</span><span class="p">()])</span>
<span class="n">learn</span><span class="o">.</span><span class="n">fit_one_cycle</span><span class="p">(</span><span class="n">n_epochs</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>masked_accuracy</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.007624</td>
      <td>0.000513</td>
      <td>1.000000</td>
      <td>00:19</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Validation with full attention:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">use_lsh</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>False</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">learn</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CPU times: user 1.4 s, sys: 848 ms, total: 2.25 s
Wall time: 2.34 s
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(#2) [0.0005133371450938284,1.0]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's reset use_lsh to True</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">use_lsh</span><span class="o">=</span><span class="kc">True</span>
<span class="n">learn</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">use_lsh</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>True</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">learn</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CPU times: user 9.42 s, sys: 832 ms, total: 10.2 s
Wall time: 10.4 s
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(#2) [4.350349426269531,0.154746875166893]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote><p>As expected validation with full attention performs <strong>better and faster</strong></p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Long-sequence-modelling">Long sequence modelling<a class="anchor-link" href="#Long-sequence-modelling"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Increase the sequence length to 1024, similar what is used in the paper.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bs</span><span class="p">,</span> <span class="n">sl</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span><span class="mi">1024</span>
<span class="n">n_epochs</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">train_sz</span> <span class="o">=</span> <span class="mi">50_000</span>
<span class="n">valid_sz</span> <span class="o">=</span> <span class="mi">10_000</span>
<span class="n">dls</span> <span class="o">=</span> <span class="n">DataLoaders</span><span class="o">.</span><span class="n">from_dsets</span><span class="p">(</span><span class="n">TwinSequence</span><span class="p">(</span><span class="n">sl</span><span class="p">,</span> <span class="n">train_sz</span><span class="p">),</span> <span class="n">TwinSequence</span><span class="p">(</span><span class="n">sl</span><span class="p">,</span> <span class="n">valid_sz</span><span class="p">),</span> <span class="n">bs</span><span class="o">=</span><span class="n">bs</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s1">&#39;cuda&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Total training steps:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">dls</span><span class="o">.</span><span class="n">train</span><span class="p">)</span><span class="o">*</span><span class="n">n_epochs</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>6248</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Transformer-LM---full-attention">Transformer LM - full attention<a class="anchor-link" href="#Transformer-LM---full-attention"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">TransformerLM</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="n">d_ff</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">n_layers</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_heads</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">max_seq_len</span><span class="o">=</span><span class="n">sl</span><span class="p">,</span> <span class="n">pos_enc</span><span class="o">=</span><span class="s1">&#39;fixed&#39;</span><span class="p">,</span>
                      <span class="n">attn_dropout</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ff_dropout</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">emb_dropout</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">learn</span> <span class="o">=</span> <span class="n">Learner</span><span class="p">(</span><span class="n">dls</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">loss_func</span><span class="o">=</span><span class="n">CrossEntropyLossFlat</span><span class="p">(</span><span class="n">ignore_index</span><span class="o">=-</span><span class="mi">100</span><span class="p">),</span> 
                <span class="n">metrics</span><span class="o">=</span><span class="n">masked_accuracy</span><span class="p">,</span> <span class="n">cbs</span><span class="o">=</span><span class="p">[</span><span class="n">MaskTargCallback</span><span class="p">()])</span>
<span class="n">learn</span><span class="o">.</span><span class="n">fit_one_cycle</span><span class="p">(</span><span class="n">n_epochs</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>masked_accuracy</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>4.835779</td>
      <td>4.836055</td>
      <td>0.009745</td>
      <td>01:48</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0.000910</td>
      <td>0.000835</td>
      <td>0.999844</td>
      <td>01:48</td>
    </tr>
    <tr>
      <td>2</td>
      <td>0.000025</td>
      <td>0.000022</td>
      <td>1.000000</td>
      <td>01:48</td>
    </tr>
    <tr>
      <td>3</td>
      <td>0.000012</td>
      <td>0.000012</td>
      <td>1.000000</td>
      <td>01:48</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">recorder</span><span class="o">.</span><span class="n">plot_loss</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">del</span> <span class="n">learn</span>
<span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">empty_cache</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The model learns the task perfectly, similar to the result reported in the paper.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="LSHLM">LSHLM<a class="anchor-link" href="#LSHLM"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">n_hashes</span><span class="o">=</span><span class="mi">4</span>
<span class="n">bucket_size</span> <span class="o">=</span> <span class="mi">64</span>
<span class="k">assert</span> <span class="n">sl</span> <span class="o">%</span> <span class="p">(</span><span class="n">bucket_size</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span> <span class="o">=</span> <span class="n">LSHLM</span><span class="p">(</span><span class="n">vocab_sz</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">d_model</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">n_layers</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_heads</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">max_seq_len</span><span class="o">=</span><span class="n">sl</span><span class="p">,</span>
              <span class="n">bucket_size</span><span class="o">=</span><span class="n">bucket_size</span><span class="p">,</span> <span class="n">n_hashes</span><span class="o">=</span><span class="n">n_hashes</span><span class="p">,</span> <span class="n">causal</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">learn</span> <span class="o">=</span> <span class="n">Learner</span><span class="p">(</span><span class="n">dls</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">loss_func</span><span class="o">=</span><span class="n">CrossEntropyLossFlat</span><span class="p">(</span><span class="n">ignore_index</span><span class="o">=-</span><span class="mi">100</span><span class="p">),</span> 
                <span class="n">metrics</span><span class="o">=</span><span class="n">masked_accuracy</span><span class="p">,</span> <span class="n">cbs</span><span class="o">=</span><span class="p">[</span><span class="n">MaskTargCallback</span><span class="p">()])</span>
<span class="n">learn</span><span class="o">.</span><span class="n">fit_one_cycle</span><span class="p">(</span><span class="n">n_epochs</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>masked_accuracy</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>4.835337</td>
      <td>4.835193</td>
      <td>0.009850</td>
      <td>03:44</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4.834929</td>
      <td>4.834915</td>
      <td>0.009803</td>
      <td>03:48</td>
    </tr>
    <tr>
      <td>2</td>
      <td>4.834819</td>
      <td>4.834768</td>
      <td>0.009833</td>
      <td>03:47</td>
    </tr>
    <tr>
      <td>3</td>
      <td>4.834756</td>
      <td>4.834733</td>
      <td>0.009887</td>
      <td>03:47</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">recorder</span><span class="o">.</span><span class="n">plot_loss</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">del</span> <span class="n">learn</span>
<span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">empty_cache</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The model struggles compared to full attention. The paper mentions 99.9% accuracy for this setup, but trained the model for 150k steps - much longer than in this case.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="LSHLM---single-hashing-round">LSHLM - single hashing round<a class="anchor-link" href="#LSHLM---single-hashing-round"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We do a test similar to the one above, but just using a single hashing round in LSH.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">n_hashes</span><span class="o">=</span><span class="mi">1</span>
<span class="n">bucket_size</span> <span class="o">=</span> <span class="mi">64</span>
<span class="k">assert</span> <span class="n">sl</span> <span class="o">%</span> <span class="p">(</span><span class="n">bucket_size</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">LSHLM</span><span class="p">(</span><span class="n">vocab_sz</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">d_model</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">n_layers</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_heads</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">max_seq_len</span><span class="o">=</span><span class="n">sl</span><span class="p">,</span>
              <span class="n">bucket_size</span><span class="o">=</span><span class="n">bucket_size</span><span class="p">,</span> <span class="n">n_hashes</span><span class="o">=</span><span class="n">n_hashes</span><span class="p">,</span> <span class="n">causal</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">learn</span> <span class="o">=</span> <span class="n">Learner</span><span class="p">(</span><span class="n">dls</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">loss_func</span><span class="o">=</span><span class="n">CrossEntropyLossFlat</span><span class="p">(</span><span class="n">ignore_index</span><span class="o">=-</span><span class="mi">100</span><span class="p">),</span> 
                <span class="n">metrics</span><span class="o">=</span><span class="n">masked_accuracy</span><span class="p">,</span> <span class="n">cbs</span><span class="o">=</span><span class="p">[</span><span class="n">MaskTargCallback</span><span class="p">()])</span>
<span class="n">learn</span><span class="o">.</span><span class="n">fit_one_cycle</span><span class="p">(</span><span class="n">n_epochs</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>masked_accuracy</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>4.835372</td>
      <td>4.835213</td>
      <td>0.009818</td>
      <td>02:09</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4.834966</td>
      <td>4.834857</td>
      <td>0.009743</td>
      <td>02:10</td>
    </tr>
    <tr>
      <td>2</td>
      <td>4.834816</td>
      <td>4.834768</td>
      <td>0.009834</td>
      <td>02:11</td>
    </tr>
    <tr>
      <td>3</td>
      <td>4.834760</td>
      <td>4.834735</td>
      <td>0.009864</td>
      <td>02:10</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">recorder</span><span class="o">.</span><span class="n">plot_loss</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">del</span> <span class="n">learn</span>
<span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">empty_cache</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Similar performance as above.</p>

</div>
</div>
</div>
</div>
 

